const axios = require("axios");

/**
 * Get AI response with owner awareness
 * @param {string} prompt
 * @returns {Promise<string>}
 */
async function getAIResponse(prompt) {
    try {
        if (!prompt || !prompt.trim()) {
            return "‚ùì Please ask me something.";
        }

        const text = prompt.trim().toLowerCase();

        // üëë OWNER OVERRIDE (always true)
        if (
            text.includes("owner") ||
            text.includes("creator") ||
            text.includes("created you") ||
            text.includes("who made you") ||
            text.includes("who owns you") ||
            text.includes("your owner") ||
            text.includes("who is your boss") ||
            text.includes("who is your developer")
        ) {
            return "üëë *My owner is Trendex.*\nHe is the developer and controller of this bot.";
        }

        const query = encodeURIComponent(prompt.trim());
        const apiUrl = `https://api.giftedtech.web.id/api/ai/ai?apikey=gifted&q=${query}`;

        const { data } = await axios.get(apiUrl, {
            timeout: 15000,
            headers: {
                "User-Agent": "Mozilla/5.0"
            }
        });

        if (data && typeof data.result === "string" && data.result.trim()) {
            return data.result.trim();
        }

        return "ü§ñ I couldn't find an answer to that.";

    } catch (error) {
        console.error("AI API Error:", error?.response?.data || error);
        return "‚ö†Ô∏è I'm having trouble responding right now. Please try again later.";
    }
}

module.exports = { getAIResponse };
